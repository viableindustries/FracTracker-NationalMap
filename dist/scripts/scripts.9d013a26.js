"use strict";angular.module("nationalMapApp",["ngResource","ngRoute","ngSanitize","ngTouch","leaflet-directive"]).config(["$routeProvider",function(a){var b={wells:{storage:"type_add7d89299a740959c5b4700bcb4668e"}};a.when("/",{templateUrl:"views/main.html",reloadOnSearch:!1,controller:"MainCtrl"}).when("/well/:featureId",{templateUrl:"views/well.html",controller:"WellCtrl",resolve:{well:["Well","$route",function(a,c){return a.get({storage:b.wells.storage,featureId:c.current.params.featureId})}]}}).otherwise({redirectTo:"/"})}]),angular.module("nationalMapApp").controller("MainCtrl",["$scope","$http","$location","Site","Map","leafletData","leafletEvents",function(a,b,c,d,e,f){a.settings=d.settings(),a.map=e.create(),a.map.update=function(b){var d=b.getZoom();switch(d){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:angular.copy(a.map.markers,a.tmp),a.map.markers={};break;default:void 0!==a.tmp&&angular.copy(a.tmp,a.map.markers);var f=b.getBounds();e.getData(f).then(function(b){a.map.markers=e.getMarkers(b)})}var g=b.getCenter();c.search({zoom:d,lat:g.lat,lng:g.lng})},f.getMap().then(function(b){var d=c.search(),e=d.zoom?d.zoom:4,f=d.lat?d.lat:39.147,g=d.lng?d.lng:-96.812;b.setView({lat:f,lng:g},e),a.$on("leafletDirectiveMarker.click",function(b,d){c.path(a.map.markers[d.markerName].permalink)}),b.getZoom()>14&&a.map.update(b),a.$on("leafletDirectiveMap.moveend",function(){a.map.update(b)}),new L.Control.Zoom({position:"bottomright"}).addTo(b),b.addControl(L.mapbox.geocoderControl("mapbox.places-v1",{autocomplete:!0,keepOpen:!0}))})}]),angular.module("nationalMapApp").controller("WellCtrl",["$scope","well",function(a,b){a.well=b}]),angular.module("nationalMapApp").service("Site",function(){var a={};return a.settings=function(){return{services:{mapbox:{access_token:"pk.eyJ1IjoiZGV2ZWxvcGVkc2ltcGxlIiwiYSI6IlROYnA5TVkifQ.xYWYVuOeP4wUli32Bnx3cA",map_id:"developedsimple.khc9mj09"}}}},a}),angular.module("nationalMapApp").service("Map",["Site","$http",function a(b,c){var a={};return a.create=function(){return{markers:{},defaults:{scrollWheelZoom:!1,zoomControl:!1,maxZoom:20},layers:{baselayers:{basemap:{name:"Satellite Imagery",url:"//{s}.tiles.mapbox.com/v4/"+b.settings().services.mapbox.map_id+"/{z}/{x}/{y}.png?access_token="+b.settings().services.mapbox.access_token,type:"xyz",layerOptions:{attribution:"<a href='https://www.mapbox.com/about/maps/' target='_blank'>&copy; Mapbox &copy; OpenStreetMap</a>"}}},overlays:{wells:{name:"Wells",type:"xyz",url:"https://{s}.tiles.mapbox.com/v4/developedsimple.b3a9ad79/{z}/{x}/{y}.png?access_token="+b.settings().services.mapbox.access_token,visible:!0}}}}},a.getMarkers=function(a){var b={};return angular.forEach(a.data.features,function(a){b[a.properties.id]={lat:a.geometry.coordinates[1],lng:a.geometry.coordinates[0],focus:!1,draggable:!1,permalink:"/well/"+a.properties.id,message:"<p>"+a.properties.well_name+"<br /><span>"+a.properties.api+"</span></p>",icon:{type:"div",className:"marker-container-default",iconSize:[16,16],popupAnchor:[0,-16]}}}),b},a.getRegion=function(a){var b=L.latLngBounds(a),c=b.getWest()+" "+b.getNorth(),d=b.getEast()+" "+b.getNorth(),e=b.getEast()+" "+b.getSouth(),f=b.getWest()+" "+b.getSouth(),g="SRID=4326;POLYGON(("+c+","+d+","+e+","+f+","+c+"))",h="http://api.commonscloud.org/v2/type_add7d89299a740959c5b4700bcb4668e/region.geojson?geometry="+g;return h},a.getData=function(b){var d=a.getRegion(b),e=c.get(d).success(function(a){return a}).error(function(a,b,c,d){console.error(a,b,c,d)});return e},a}]),angular.module("nationalMapApp").provider("Well",function(){this.$get=["$resource",function(a){var b=a("//api.commonscloud.org/v2/:storage.json",{},{query:{method:"GET",params:{statistics:!1,relationship:!1},isArray:!1,transformResponse:function(a){return angular.fromJson(a)}},get:{method:"GET",url:"//api.commonscloud.org/v2/:storage/:featureId.json"}});return b}]}),function(window,undefined){L.Util.ajax=function(url,cb){window.XMLHttpRequest===undefined&&(window.XMLHttpRequest=function(){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){throw Error("XMLHttpRequest is not supported")}});var response,request=new XMLHttpRequest;request.open("GET",url),request.onreadystatechange=function(){4===request.readyState&&200===request.status&&(response=window.JSON?JSON.parse(request.responseText):eval("("+request.responseText+")"),cb(response))},request.send()},L.UtfGrid=L.Class.extend({includes:L.Mixin.Events,options:{subdomains:"abc",minZoom:0,maxZoom:18,tileSize:256,resolution:4,useJsonP:!0,pointerCursor:!0},_mouseOn:null,initialize:function(a,b){L.Util.setOptions(this,b),this._url=a,this._cache={};for(var c=0;window["lu"+c];)c++;this._windowKey="lu"+c,window[this._windowKey]={};var d=this.options.subdomains;"string"==typeof this.options.subdomains&&(this.options.subdomains=d.split(""))},onAdd:function(a){this._map=a,this._container=this._map._container,this._update();var b=this._map.getZoom();b>this.options.maxZoom||b<this.options.minZoom||(a.on("click",this._click,this),a.on("mousemove",this._move,this),a.on("moveend",this._update,this))},onRemove:function(){var a=this._map;a.off("click",this._click,this),a.off("mousemove",this._move,this),a.off("moveend",this._update,this),this.options.pointerCursor&&(this._container.style.cursor="")},_click:function(a){this.fire("click",this._objectForEvent(a))},_move:function(a){var b=this._objectForEvent(a);b.data!==this._mouseOn?(this._mouseOn&&(this.fire("mouseout",{latlng:a.latlng,data:this._mouseOn}),this.options.pointerCursor&&(this._container.style.cursor="")),b.data&&(this.fire("mouseover",b),this.options.pointerCursor&&(this._container.style.cursor="pointer")),this._mouseOn=b.data):b.data&&this.fire("mousemove",b)},_objectForEvent:function(a){var b=this._map,c=b.project(a.latlng),d=this.options.tileSize,e=this.options.resolution,f=Math.floor(c.x/d),g=Math.floor(c.y/d),h=Math.floor((c.x-f*d)/e),i=Math.floor((c.y-g*d)/e),j=b.options.crs.scale(b.getZoom())/d;f=(f+j)%j,g=(g+j)%j;var k=this._cache[b.getZoom()+"_"+f+"_"+g];if(!k)return{latlng:a.latlng,data:null};var l=this._utfDecode(k.grid[i].charCodeAt(h)),m=k.keys[l],n=k.data[m];return k.data.hasOwnProperty(m)||(n=null),{latlng:a.latlng,data:n}},_update:function(){var a=this._map.getPixelBounds(),b=this._map.getZoom(),c=this.options.tileSize;if(!(b>this.options.maxZoom||b<this.options.minZoom))for(var d=new L.Point(Math.floor(a.min.x/c),Math.floor(a.min.y/c)),e=new L.Point(Math.floor(a.max.x/c),Math.floor(a.max.y/c)),f=this._map.options.crs.scale(b)/c,g=d.x;g<=e.x;g++)for(var h=d.y;h<=e.y;h++){var i=(g+f)%f,j=(h+f)%f,k=b+"_"+i+"_"+j;this._cache.hasOwnProperty(k)||(this._cache[k]=null,this.options.useJsonP?this._loadTileP(b,i,j):this._loadTile(b,i,j))}},_loadTileP:function(a,b,c){var d=document.getElementsByTagName("head")[0],e=a+"_"+b+"_"+c,f="lu_"+e,g=this._windowKey,h=this,i=L.Util.template(this._url,L.Util.extend({s:L.TileLayer.prototype._getSubdomain.call(this,{x:b,y:c}),z:a,x:b,y:c,cb:g+"."+f},this.options)),j=document.createElement("script");j.setAttribute("type","text/javascript"),j.setAttribute("src",i),window[g][f]=function(a){h._cache[e]=a,delete window[g][f],d.removeChild(j)},d.appendChild(j)},_loadTile:function(a,b,c){var d=L.Util.template(this._url,L.Util.extend({s:L.TileLayer.prototype._getSubdomain.call(this,{x:b,y:c}),z:a,x:b,y:c},this.options)),e=a+"_"+b+"_"+c,f=this;L.Util.ajax(d,function(a){f._cache[e]=a})},_utfDecode:function(a){return a>=93&&a--,a>=35&&a--,a-32}}),L.utfGrid=function(a,b){return new L.UtfGrid(a,b)}}(this);